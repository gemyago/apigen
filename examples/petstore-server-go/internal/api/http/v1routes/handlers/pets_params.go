// Code generated by apigen DO NOT EDIT.

package handlers

import (
	"net/http"
	"time"

	. "github.com/gemyago/apigen/examples/petstore-server-go/internal/api/http/v1routes/models"
	. "github.com/gemyago/apigen/examples/petstore-server-go/internal/api/http/v1routes/internal"
)

// Below is to workaround unused imports if that happens.
var _ = BindingContext{}
var _ = http.MethodGet
var _ = time.Time{}
type _ func() Error

type paramsParserPetsCreatePet struct {
	bindPayload requestParamBinder[*http.Request, *Pet]
}

func (p *paramsParserPetsCreatePet) parse(router httpRouter, req *http.Request) (*PetsCreatePetRequest, error) {
	bindingCtx := BindingContext{}
	reqParams := &PetsCreatePetRequest{}
	// body params
	p.bindPayload(bindingCtx.Fork("body"), readRequestBodyValue(req), &reqParams.Payload)
	return reqParams, bindingCtx.AggregatedError()
}

func newParamsParserPetsCreatePet(rootHandler *RootHandler) paramsParser[*PetsCreatePetRequest] {
	return &paramsParserPetsCreatePet{
		bindPayload: newRequestParamBinder(binderParams[*http.Request, *Pet]{
			required: true,
			parseValue: parseSoloValueParamAsSoloValue(
				parseJSONPayload[*Pet],
			),
			validateValue: NewPetValidator(),
		}),
	}
}

type paramsParserPetsGetPetByID struct {
	bindPetID requestParamBinder[string, int64]
}

func (p *paramsParserPetsGetPetByID) parse(router httpRouter, req *http.Request) (*PetsGetPetByIDRequest, error) {
	bindingCtx := BindingContext{}
	reqParams := &PetsGetPetByIDRequest{}
	// path params
	pathParamsCtx := bindingCtx.Fork("path")
	p.bindPetID(pathParamsCtx.Fork("petId"), readPathValue("petId", router, req), &reqParams.PetID)
	return reqParams, bindingCtx.AggregatedError()
}

func newParamsParserPetsGetPetByID(rootHandler *RootHandler) paramsParser[*PetsGetPetByIDRequest] {
	return &paramsParserPetsGetPetByID{
		bindPetID: newRequestParamBinder(binderParams[string, int64]{
			required: true,
			parseValue: parseSoloValueParamAsSoloValue(
				rootHandler.knownParsers.int64Parser,
			),
			validateValue: NewSimpleFieldValidator[int64](
			),
		}),
	}
}

type paramsParserPetsListPets struct {
	bindLimit requestParamBinder[[]string, int64]
	bindOffset requestParamBinder[[]string, int64]
}

func (p *paramsParserPetsListPets) parse(router httpRouter, req *http.Request) (*PetsListPetsRequest, error) {
	bindingCtx := BindingContext{}
	reqParams := &PetsListPetsRequest{}
	// query params
	query := req.URL.Query()
	queryParamsCtx := bindingCtx.Fork("query")
	p.bindLimit(queryParamsCtx.Fork("limit"), readQueryValue("limit", query), &reqParams.Limit)
	p.bindOffset(queryParamsCtx.Fork("offset"), readQueryValue("offset", query), &reqParams.Offset)
	return reqParams, bindingCtx.AggregatedError()
}

func newParamsParserPetsListPets(rootHandler *RootHandler) paramsParser[*PetsListPetsRequest] {
	return &paramsParserPetsListPets{
		bindLimit: newRequestParamBinder(binderParams[[]string, int64]{
			required: true,
			parseValue: parseMultiValueParamAsSoloValue(
				rootHandler.knownParsers.int64Parser,
			),
			validateValue: NewSimpleFieldValidator[int64](
				NewMinMaxValueValidator[int64](1, false, true),
				NewMinMaxValueValidator[int64](100, false, false),
			),
		}),
		bindOffset: newRequestParamBinder(binderParams[[]string, int64]{
			required: false,
			parseValue: parseMultiValueParamAsSoloValue(
				rootHandler.knownParsers.int64Parser,
			),
			validateValue: NewSimpleFieldValidator[int64](
				NewMinMaxValueValidator[int64](1, false, true),
			),
		}),
	}
}

type petsControllerBuilder struct {
	// POST /pets
	//
	// Request type: PetsCreatePetRequest,
	//
	// Response type: none
	CreatePet genericHandlerBuilder[
		*PetsCreatePetRequest,
		void,
		handlerActionFuncNoResponse[*PetsCreatePetRequest, void],
		httpHandlerActionFuncNoResponse[*PetsCreatePetRequest, void],
	]

	// GET /pets/{petId}
	//
	// Request type: PetsGetPetByIDRequest,
	//
	// Response type: PetResponse
	GetPetByID genericHandlerBuilder[
		*PetsGetPetByIDRequest,
		*PetResponse,
		handlerActionFunc[*PetsGetPetByIDRequest, *PetResponse],
		httpHandlerActionFunc[*PetsGetPetByIDRequest, *PetResponse],
	]

	// GET /pets
	//
	// Request type: PetsListPetsRequest,
	//
	// Response type: PetsResponse
	ListPets genericHandlerBuilder[
		*PetsListPetsRequest,
		*PetsResponse,
		handlerActionFunc[*PetsListPetsRequest, *PetsResponse],
		httpHandlerActionFunc[*PetsListPetsRequest, *PetsResponse],
	]
}

func newPetsControllerBuilder(app *RootHandler) *petsControllerBuilder {
	return &petsControllerBuilder{
		// POST /pets
		CreatePet: newGenericHandlerBuilder(
			app,
			newHandlerAdapterNoResponse[
				*PetsCreatePetRequest,
				void,
			](),
			newHTTPHandlerAdapterNoResponse[
				*PetsCreatePetRequest,
				void,
			](),
			makeActionBuilderParams[
				*PetsCreatePetRequest,
				void,
			]{
				defaultStatus: 201,
				voidResult:    true,
				paramsParser:  newParamsParserPetsCreatePet(app),
			},
		),

		// GET /pets/{petId}
		GetPetByID: newGenericHandlerBuilder(
			app,
			newHandlerAdapter[
				*PetsGetPetByIDRequest,
				*PetResponse,
			](),
			newHTTPHandlerAdapter[
				*PetsGetPetByIDRequest,
				*PetResponse,
			](),
			makeActionBuilderParams[
				*PetsGetPetByIDRequest,
				*PetResponse,
			]{
				defaultStatus: 200,
				paramsParser:  newParamsParserPetsGetPetByID(app),
			},
		),

		// GET /pets
		ListPets: newGenericHandlerBuilder(
			app,
			newHandlerAdapter[
				*PetsListPetsRequest,
				*PetsResponse,
			](),
			newHTTPHandlerAdapter[
				*PetsListPetsRequest,
				*PetsResponse,
			](),
			makeActionBuilderParams[
				*PetsListPetsRequest,
				*PetsResponse,
			]{
				defaultStatus: 200,
				paramsParser:  newParamsParserPetsListPets(app),
			},
		),
	}
}
