{{ #generatedCodeComment }}// {{.}}.

{{/generatedCodeComment}}package {{package}}

import (
	"net/http"
	"time"
	{{#hasImportedModel}}

	"{{invokerPackage}}/models"
{{/hasImportedModel}}
	"{{invokerPackage}}/internal"
)

// Below is to workaround unused imports.
var _ = time.Time{}{{#hasImportedModel}}
var _ = {{importedModels.0}}{}{{/hasImportedModel}}

{{#operations}}
{{#operation}}
{{#hasParams}}
type paramsParser{{baseName}}{{operationId}} struct {
	{{#allParams}}
	bind{{>params/name}} requestParamBinder[{{>params/binder-types}}]
	{{/allParams}}
}

func (p *paramsParser{{baseName}}{{operationId}}) parse(router httpRouter, req *http.Request) (*{{>request-type}}, error) {
	bindingCtx := internal.BindingContext{}
	reqParams := &{{>request-type}}{}
	{{#pathParams}}
	{{#-first}}// path params
	{{/-first}}p.bind{{>params/name}}(&bindingCtx, readPathValue("{{baseName}}", router, req), &reqParams.{{>params/name}})
	{{/pathParams}}
	{{#queryParams}}
	{{#-first}}// query params
	query := req.URL.Query()
	{{/-first}}p.bind{{>params/name}}(&bindingCtx, readQueryValue("{{baseName}}", query), &reqParams.{{>params/name}})
	{{/queryParams}}
	{{#bodyParams}}
	{{#-first}}// body params
	{{/-first}}p.bind{{>params/name}}(&bindingCtx, readRequestBodyValue(req), &reqParams.Payload)
	{{/bodyParams}}
	return reqParams, bindingCtx.AggregatedError()
}

func newParamsParser{{baseName}}{{operationId}}(app *HTTPApp) paramsParser[*{{>request-type}}] {
	return &paramsParser{{baseName}}{{operationId}}{
		{{#allParams}}
    // isNullable: {{{isNullable}}}
		bind{{>params/name}}: newRequestParamBinder(binderParams[{{>params/binder-types}}]{
			field: "{{baseName}}",
			location: {{#isBodyParam}}"body"{{/isBodyParam}}{{^isBodyParam}}"{{#vendorExtensions}}{{x-codegen-param-in}}{{/vendorExtensions}}"{{/isBodyParam}},
			required: {{required}},
			parseValue: {{^isBodyParam}}{{#isNullable}}parseNullableIn{{#vendorExtensions}}{{#lambda.titlecase}}{{x-codegen-param-in}}{{/lambda.titlecase}}{{/vendorExtensions}}({{/isNullable}}{{/isBodyParam}}{{#isBodyParam}}parseJSONPayload[{{>params/type}}]{{/isBodyParam}}{{^isBodyParam}}app.knownParsers.{{#isDate}}date{{/isDate}}{{#isDateTime}}time{{/isDateTime}}{{^isDate}}{{^isDateTime}}{{dataType}}{{/isDateTime}}{{/isDate}}In{{#vendorExtensions}}{{#lambda.titlecase}}{{x-codegen-param-in}}{{/lambda.titlecase}}{{/vendorExtensions}}{{/isBodyParam}}{{^isBodyParam}}{{#isNullable}}){{/isNullable}}{{/isBodyParam}},
			validateValue: {{#isArray}}internal.NewArrayValidator(
        internal.New{{#mostInnerItems}}{{{dataType}}}{{/mostInnerItems}}Validator(),
      ),{{/isArray}}{{^isArray}}{{#isBodyParam}}{{#isNullable}}internal.SkipNullFieldValidator({{/isNullable}}internal.New{{dataType}}Validator(){{#isNullable}}){{/isNullable}},{{/isBodyParam}}{{^isBodyParam}}internal.NewSimpleFieldValidator[{{>params/type}}]({{#minimum}}
				{{#isNullable}}internal.SkipNullValidator({{/isNullable}}internal.NewMinMaxValueValidator[{{{dataType}}}]({{.}}, {{exclusiveMinimum}}, true){{#isNullable}}){{/isNullable}},{{/minimum}}{{#maximum}}
				{{#isNullable}}internal.SkipNullValidator({{/isNullable}}internal.NewMinMaxValueValidator[{{{dataType}}}]({{.}}, {{exclusiveMaximum}}, false){{#isNullable}}){{/isNullable}},{{/maximum}}{{^isDate}}{{^isDateTime}}{{#minLength}}
				{{#isNullable}}internal.SkipNullValidator({{/isNullable}}internal.NewMinMaxLengthValidator[{{{dataType}}}]({{.}}, true){{#isNullable}}){{/isNullable}},{{/minLength}}{{#maxLength}}
				{{#isNullable}}internal.SkipNullValidator({{/isNullable}}internal.NewMinMaxLengthValidator[{{{dataType}}}]({{.}}, false){{#isNullable}}){{/isNullable}},{{/maxLength}}{{#pattern}}
				{{#isNullable}}internal.SkipNullValidator({{/isNullable}}internal.NewPatternValidator[{{{dataType}}}]("{{.}}"){{#isNullable}}){{/isNullable}},{{/pattern}}{{/isDateTime}}{{/isDate}}
			),{{/isBodyParam}}{{/isArray}}
		}),
		{{/allParams}}
	}
}{{^-last}}

{{/-last}}{{/hasParams}}{{/operation}}
{{/operations}}
